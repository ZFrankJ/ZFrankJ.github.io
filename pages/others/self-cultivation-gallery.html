<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fujia Zhang | Self-Cultivation Gallery</title>
  <script>
    (function () {
      const saved = localStorage.getItem("fz-theme");
      const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches;
      const mode = saved || "system";
      const theme = mode === "system" ? (prefersLight ? "light" : "dark") : mode;
      document.documentElement.classList.toggle("theme-light", theme === "light");
      window.__fzPreferredTheme = theme;
      window.__fzThemeMode = mode;
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="../../assets/css/site.css?v=5" />
  <style>
    .gallery-shell {
      display: grid;
      gap: 16px;
    }

    .gallery-head {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px 16px;
    }

    .gallery-head h2 {
      margin: 0;
    }

    .gallery-nav {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 14px;
    }

    .gallery-arrow {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--panel-strong);
      color: var(--text);
      font-size: 1.25rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.2s ease, opacity 0.2s ease;
      box-shadow: var(--shadow);
    }

    .gallery-arrow:hover:not(:disabled) {
      transform: translateY(-1px);
    }

    .gallery-arrow:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      box-shadow: none;
    }

    .gallery-stage {
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: var(--panel-strong);
      min-height: clamp(220px, 48vh, 560px);
      height: clamp(220px, 48vh, 560px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 14px;
      box-shadow: var(--shadow);
    }

    .gallery-stage img {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg);
      transition: opacity 0.2s ease;
    }

    .gallery-stage .media-load-indicator {
      border-radius: 10px;
      background: var(--panel-strong);
    }

    .gallery-stage.is-loading .media-load-indicator {
      opacity: 1;
    }

    .gallery-stage.is-loading img {
      opacity: 0.18;
    }

    @media (max-width: 720px) {
      .gallery-arrow {
        width: 48px;
        height: 48px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="breadcrumbs">
      <a href="../../index.html">Home</a>
      <span>-</span>
      <a href="./index.html">Others</a>
      <span>-</span>
      <span>Self-Cultivation Gallery</span>
    </div>

    <header class="sub-hero" data-lens>
      <h1>Self-Cultivation Gallery</h1>
      <p class="lede">Karate, calligraphy, and Duke of Edinburgh moments collected in one place.</p>
    </header>

    <div class="back-row">
      <a class="pill pill--ghost" href="./index.html">← Back to Others</a>
    </div>

    <main class="content">
      <section class="content-section gallery-shell">
        <div class="gallery-head">
          <h2 id="gallery-title">Karate · 1 / 3</h2>
          <p class="muted" id="gallery-meta">Image 1 of 10</p>
        </div>

        <div class="gallery-nav">
          <button class="gallery-arrow" id="gallery-prev" aria-label="Previous image">←</button>
          <div class="gallery-stage media-load-shell" id="gallery-stage">
            <img id="gallery-image" data-loader-skip="true" src="../../assets/img/others-karate-1.png" alt="Karate image 1" />
            <div class="media-load-indicator" aria-live="polite">
              <span class="media-load-dot" aria-hidden="true"></span>
              <span class="media-load-label">Loading image</span>
            </div>
          </div>
          <button class="gallery-arrow" id="gallery-next" aria-label="Next image">→</button>
        </div>
      </section>
    </main>
  </div>

  <div class="control-bubbles" aria-label="Display controls">
    <button class="bubble" data-toggle="theme" aria-pressed="false" title="Switch theme">☀</button>
    <button class="bubble bubble--ghost" data-toggle="lens" aria-pressed="true" title="Disable liquid lens">FX</button>
  </div>

  <script>
    (function () {
      const images = [
        { src: "../../assets/img/others-karate-1.png", alt: "Karate image 1", group: "Karate", groupIndex: 1, groupTotal: 3 },
        { src: "../../assets/img/others-karate-2.png", alt: "Karate image 2", group: "Karate", groupIndex: 2, groupTotal: 3 },
        { src: "../../assets/img/others-karate-3.png", alt: "Karate image 3", group: "Karate", groupIndex: 3, groupTotal: 3 },
        { src: "../../assets/img/others-calligraphy-1.png", alt: "Calligraphy image 1", group: "Calligraphy", groupIndex: 1, groupTotal: 4 },
        { src: "../../assets/img/others-calligraphy-2.png", alt: "Calligraphy image 2", group: "Calligraphy", groupIndex: 2, groupTotal: 4 },
        { src: "../../assets/img/others-calligraphy-3.png", alt: "Calligraphy image 3", group: "Calligraphy", groupIndex: 3, groupTotal: 4 },
        { src: "../../assets/img/others-calligraphy-4.png", alt: "Calligraphy image 4", group: "Calligraphy", groupIndex: 4, groupTotal: 4 },
        { src: "../../assets/img/others-duke-edinburgh-1.png", alt: "Duke of Edinburgh image 1", group: "Duke of Edinburgh", groupIndex: 1, groupTotal: 3 },
        { src: "../../assets/img/others-duke-edinburgh-2.png", alt: "Duke of Edinburgh image 2", group: "Duke of Edinburgh", groupIndex: 2, groupTotal: 3 },
        { src: "../../assets/img/others-duke-edinburgh-3.png", alt: "Duke of Edinburgh image 3", group: "Duke of Edinburgh", groupIndex: 3, groupTotal: 3 }
      ];

      const startByHash = {
        "#karate": 0,
        "#calligraphy": 3,
        "#duke-edinburgh": 7
      };

      const imageEl = document.getElementById("gallery-image");
      const stageEl = document.getElementById("gallery-stage");
      const titleEl = document.getElementById("gallery-title");
      const metaEl = document.getElementById("gallery-meta");
      const prevBtn = document.getElementById("gallery-prev");
      const nextBtn = document.getElementById("gallery-next");

      let index = startByHash[window.location.hash] ?? 0;
      let pendingLoadId = 0;

      function updateButtons(isLoading) {
        prevBtn.disabled = isLoading || index === 0;
        nextBtn.disabled = isLoading || index === images.length - 1;
      }

      function setLoading(isLoading) {
        stageEl.classList.toggle("is-loading", isLoading);
        updateButtons(isLoading);
      }

      function render() {
        const item = images[index];
        const loadId = ++pendingLoadId;
        const nextSrc = item.src;
        const isSameSrc = imageEl.getAttribute("src") === nextSrc;

        titleEl.textContent = item.group + " · " + item.groupIndex + " / " + item.groupTotal;
        metaEl.textContent = "Image " + (index + 1) + " of " + images.length;

        setLoading(true);
        imageEl.alt = item.alt;

        imageEl.onload = function () {
          if (loadId !== pendingLoadId) return;
          setLoading(false);
        };

        imageEl.onerror = function () {
          if (loadId !== pendingLoadId) return;
          metaEl.textContent = "Image " + (index + 1) + " of " + images.length + " · missing file";
          setLoading(false);
        };

        if (!isSameSrc) {
          imageEl.src = nextSrc;
        }

        // Cached or same-source images can be complete immediately with no onload callback.
        if (imageEl.complete) {
          if (imageEl.naturalWidth > 0) {
            setLoading(false);
          } else {
            metaEl.textContent = "Image " + (index + 1) + " of " + images.length + " · missing file";
            setLoading(false);
          }
        }
      }

      function goTo(nextIndex) {
        if (nextIndex < 0 || nextIndex >= images.length) return;
        if (nextIndex === index) return;
        if (stageEl.classList.contains("is-loading")) return;

        index = nextIndex;
        render();
      }

      prevBtn.addEventListener("click", function () {
        goTo(index - 1);
      });

      nextBtn.addEventListener("click", function () {
        goTo(index + 1);
      });

      document.addEventListener("keydown", function (event) {
        if (event.key === "ArrowLeft") {
          goTo(index - 1);
        }
        if (event.key === "ArrowRight") {
          goTo(index + 1);
        }
      });

      render();
    })();
  </script>

  <script type="module" src="../../assets/js/site.js?v=5"></script>
</body>
</html>
